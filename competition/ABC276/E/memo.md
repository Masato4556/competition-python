TLEになってしまい解けず、解説を見た。

その後、UnionFindで回答